/*! app_missevan_chat 2015-08-13 by tengattack */
var ChatBubble;ChatBubble=function(){function a(){this._showname=!0}return a.prototype.init=function(){var a;this.stage=$("#commentCanvas"),a=$("#chatmain .container"),a.prepend('<div id="chatbubble"><ul id="chat"></ul></div>'),this.el=a.find("#chat"),chatBox.isMobile&&(moTool.boardReplaceTxt=GG.util.escape,index.mo.chatLine=1,a.find("#chatbubble").css("width","100%"))},a.prototype.reset=function(){this.el.html(""),this.background()},a.prototype.xss=function(a){var b,c;return b=a.replace(/<img [^>]*?src=(".+?")[^>]*?\/?>/gi,"|img:$1|"),c=moTool.boardReplaceTxt(b),c.replace(/\|img\:&quot;(.+?)&quot;\|/gi,'<img src="$1" />')},a.prototype.showname=function(a){this._showname=a},a.prototype.addhtml=function(a){this.el.append(a),$("#chatmain").animate({scrollTop:this.el.height()},200)},a.prototype.text=function(a){var b,c;c=moTool.boardReplaceTxt(a),b='<li id="chatline'+index.mo.chatLine+'"><div class="chatinfo"><span>'+c+"</span></div></li>",index.mo.chatLine++,this.addhtml(b)},a.prototype.stateimage=function(a,b){var c,d;d=this,c=new Image,c.onload=function(){var c;c='<li id="chatline'+index.mo.chatLine+'"><div class="chatinfo"><img class="state-image" src='+JSON.stringify(a)+" /></div></li>",index.mo.chatLine++,d.addhtml(c),null!=b&&b()},c.src=a},a.prototype.background=function(a,b){var c;a?(c=new Image,c.onload=function(){$("#chatmain").css("background-image","url("+a.url+")"),null!=b&&b()},c.src=a.url):($("#chatmain").css("background-image","none"),null!=b&&b())},a.prototype.popup=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;switch(g=this,h="",e=null!=a.sender.iconColor?a.sender.iconColor:"#91c0edm#cde1edm#709cc9m#5079c9m#709cc9",d=e.split("m"),a.sender.subTitle&&(i="#000000"===d[0]?"#A3A3A3":d[0],h="<span style='color:"+i+";'>"+moTool.boardReplaceTxt(a.sender.subTitle)+"</span>"),l=1===index.mo.bgType?"#ffffff":"#000000",k=a.sender.name,m=moTool.boardReplaceTxt(k),h&&(m+=" ("+h+")"),a.type){case 1:j=this.xss(a.msg),j=j.replace(/\n/g,"<br>"),c="<li ","right"===a.showon&&(c+='class="author" '),c+='id="chatline'+index.mo.chatLine+'">\n  <div class="userFace"><img src="'+a.sender.icon+'" alt=""></div>\n',this._showname&&(c+='  <div class="userName" style="color:'+l+'">'+m+"</div>\n"),c+='  <div class="userSay">\n    <div class="inlineText">'+j+"</div>\n  </div>\n</li>",index.mo.chatLine++,this.addhtml(c),null!=b&&b();break;case 7:f=new Image,f.onload=function(){var d,e,f,h;d=this.height,h=this.width,f=600,chatBox.isMobile&&(f=225),h>f&&(h=f,d=Math.floor(f*this.height/this.width)),d>600&&(h=Math.floor(600*this.width/this.height),d=600),e='<a target="_blank" href="'+a.msg+'"><img style="width:'+h+"px;height:"+d+'px" src="'+a.msg+'" /></a>',c="<li ","right"===a.showon&&(c+='class="author" '),c+='id="chatline'+index.mo.chatLine+'">\n  <div class="userFace"><img src="'+a.sender.icon+'" alt=""></div>\n',g._showname&&(c+='  <div class="userName" style="color:'+l+'">'+m+"</div>\n"),c+='  <div class="userChatImage">'+e+"</div>\n</li>",index.mo.chatLine++,g.addhtml(c),null!=b&&b()},f.src=a.msg}play.soundBox.playChat()},a.prototype.tobottom=function(){this.stage.clearQueue().stop().animate({scrollTop:this.el.height()},1e3)},a.prototype.isbottom=function(){var a,b;return b=this.stage.height(),a=this.el.height(),a-b<this.stage.scrollTop()},a}();